<div class='cms-wrapper cms-uploads-<?if($uploads):?>1 clearfix<?else:?>0<?endif?>'>
<?if($current_user->allowed($module_name, "index")):?>
  <?$mods = CMSApplication::get_modules()?>
  <div class='index_container'>
    <div class='clearfix filters_pagination <?if(!$tree_layout && $cms_content->total_without_limits() > $per_page):?> pagination_used<?endif?>'>
      <?if(!$tree_layout):?>
      <div class='pagination pagination_top'>
        <?=paginate_links($cms_content, "2")?>
      </div>
      <?endif?>
      <?=partial("_filter_block");?>
    </div>

    <div class='listing' id="data-listing">
      <?=partial("_list", array('tree_layout'=>$tree_layout, 'cms_content'=>$cms_content, 'scaffold_columns'=>$scaffold_columns, 'controller'=>$controller, 'operation_actions'=>$operation_actions, 'current_user'=>$current_user, 'module_name'=>$module_name))?>
    </div>
    <?if(!$tree_layout):?>
    <div class='pagination pagination_bottom clearfix'>
      <?=paginate_links($cms_content, "2")?>
    </div>
    <?endif?>
  </div>
  <?if($uploads):?>
  <div class='upload_block'>
    <?=partial("_media_preview");?>
    <form action="upload" method="post" enctype="multipart/form-data" class='clearfix'>
    <?=partial("_upload_block", array('controller'=>$controller));?>
    </form>
  </div>
  <?endif?>
  <?if($tree_layout && ($tree_view = partial("_tree", array('cms_content'=>$cms_content, 'scaffold_columns'=>$scaffold_columns, 'controller'=>$controller, 'operation_actions'=>$operation_actions, 'current_user'=>$current_user, 'module_name'=>$module_name, 'full_tree'=>$full_tree, 'mods'=>$mods, 'sortable'=>$sortable)))):?>
    <div class='tree clearfix' id="data-tree">
      <?=$tree_view?>
    </div>
  <?endif?>
<?endif?>
</div>